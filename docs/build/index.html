<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SecondStoryJS: Router</title>
<link type="text/css" href="/stylesheets/twilight.css" rel="stylesheet" media="screen">
<style type="text/css">
      /* line 14, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      html, body, div, span, applet, object, iframe,
      h1, h2, h3, h4, h5, h6, p, blockquote, pre,
      a, abbr, acronym, address, big, cite, code,
      del, dfn, em, font, img, ins, kbd, q, s, samp,
      small, strike, strong, sub, sup, tt, var,
      dl, dt, dd, ol, ul, li,
      fieldset, form, label, legend,
      table, caption, tbody, tfoot, thead, tr, th, td {
        margin: 0;
        padding: 0;
        border: 0;
        outline: 0;
        font-weight: inherit;
        font-style: inherit;
        font-size: 100%;
        font-family: inherit;
        vertical-align: baseline; }
      
      /* line 17, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      body {
        line-height: 1;
        color: black;
        background: white; }
      
      /* line 19, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      ol, ul {
        list-style: none; }
      
      /* line 21, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      table {
        border-collapse: separate;
        border-spacing: 0;
        vertical-align: middle; }
      
      /* line 23, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      caption, th, td {
        text-align: left;
        font-weight: normal;
        vertical-align: middle; }
      
      /* line 25, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      q, blockquote {
        quotes: "" ""; }
        /* line 96, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
        q:before, q:after, blockquote:before, blockquote:after {
          content: ""; }
      
      /* line 27, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/reset/_utilities.scss */
      a img {
        border: none; }
      
      /* line 39, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      body {
        line-height: 1.5;
        font-family: Georgia, Palatino, "Palatino Linotype", Times, "Times New Roman", serif;
        color: #abb1a4;
        font-size: 87.5%; }
      
      /* line 68, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h1, h2, h3, h4, h5, h6 {
        font-weight: normal;
        color: white; }
        /* line 69, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
        h1 img, h2 img, h3 img, h4 img, h5 img, h6 img {
          margin: 0; }
      
      /* line 70, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h1 {
        font-size: 3em;
        line-height: 1;
        margin-bottom: 0.50em; }
      
      /* line 71, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h2 {
        font-size: 2em;
        margin-bottom: 0.75em; }
      
      /* line 72, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h3 {
        font-size: 1.5em;
        line-height: 1;
        margin-bottom: 1.00em; }
      
      /* line 73, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h4 {
        font-size: 1.2em;
        line-height: 1.25;
        margin-bottom: 1.25em; }
      
      /* line 74, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h5 {
        font-size: 1em;
        font-weight: bold;
        margin-bottom: 1.50em; }
      
      /* line 75, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      h6 {
        font-size: 1em;
        font-weight: bold; }
      
      /* line 76, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      p {
        margin: 0 0 1.5em; }
        /* line 77, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
        p img.left {
          display: inline;
          float: left;
          margin: 1.5em 1.5em 1.5em 0;
          padding: 0; }
        /* line 78, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
        p img.right {
          display: inline;
          float: right;
          margin: 1.5em 0 1.5em 1.5em;
          padding: 0; }
      
      /* line 80, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      a {
        text-decoration: underline;
        color: #ffb700; }
        /* line 18, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/utilities/links/_link-colors.scss */
        a:visited {
          color: #ffb700; }
        /* line 22, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/utilities/links/_link-colors.scss */
        a:focus {
          color: #ffb700; }
        /* line 26, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/utilities/links/_link-colors.scss */
        a:hover {
          color: #ff5d01; }
        /* line 30, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/compass/stylesheets/compass/utilities/links/_link-colors.scss */
        a:active {
          color: #ffb700; }
      
      /* line 81, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      blockquote {
        margin: 1.5em;
        color: #666666;
        font-style: italic; }
      
      /* line 82, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      strong {
        font-weight: bold; }
      
      /* line 83, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      em {
        font-style: italic; }
      
      /* line 84, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      dfn {
        font-style: italic;
        font-weight: bold; }
      
      /* line 85, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      sup, sub {
        line-height: 0; }
      
      /* line 86, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      abbr, acronym {
        border-bottom: 1px dotted #666666; }
      
      /* line 87, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      address {
        margin: 0 0 1.5em;
        font-style: italic; }
      
      /* line 88, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      del {
        color: #666666; }
      
      /* line 89, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      pre {
        margin: 1.5em 0;
        white-space: pre; }
      
      /* line 90, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      pre, code, tt {
        font: 1em "andale mono", "lucida console", monospace;
        line-height: 1.5; }
      
      /* line 91, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      li ul, li ol {
        margin: 0; }
      
      /* line 92, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      ul, ol {
        margin: 0 1.5em 1.5em 0;
        padding-left: 3.333em; }
      
      /* line 93, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      ul {
        list-style-type: disc; }
      
      /* line 94, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      ol {
        list-style-type: decimal; }
      
      /* line 95, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      dl {
        margin: 0 0 1.5em 0; }
        /* line 96, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
        dl dt {
          font-weight: bold; }
      
      /* line 97, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      dd {
        margin-left: 1.5em; }
      
      /* line 98, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      table {
        margin-bottom: 1.4em;
        width: 100%; }
      
      /* line 99, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      th {
        font-weight: bold; }
      
      /* line 100, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      thead th {
        background: #c3d9ff; }
      
      /* line 101, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      th, td, caption {
        padding: 4px 10px 4px 5px; }
      
      /* line 102, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      tr.even td {
        background: #e5ecf9; }
      
      /* line 103, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      tfoot {
        font-style: italic; }
      
      /* line 104, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      caption {
        background: #eeeeee; }
      
      /* line 105, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      .quiet {
        color: #666666; }
      
      /* line 106, /usr/lib/ruby/gems/1.8/gems/compass-0.10.5/frameworks/blueprint/stylesheets/./blueprint/./_typography.scss */
      .loud {
        color: #111111; }
      
      /* line 18 */
      body {
        background: black url("http://secondstory.com/srv/image_buckets/website-backgrounds/random_uri.xhtml") no-repeat fixed;
        background-size: 100% 100%; }
      
      /* line 22 */
      #frame {
        width: 950px;
        margin: 0 auto;
        overflow: hidden;
        *zoom: 1;
        background: rgba(0, 0, 0, 0.9) url('/images/croc.png') no-repeat 330px 0; }
        /* line 25 */
        #frame h1 {
          padding-left: 80px;
          margin-top: 36px; }
          /* line 28 */
          #frame h1 a {
            display: block;
            text-indent: -119988px;
            overflow: hidden;
            text-align: left;
            background-image: url('/images/logo.png');
            background-repeat: no-repeat;
            background-position: 0 0;
            width: 212px;
            height: 46px;
            height: 23px; }
            /* line 32 */
            #frame h1 a:hover {
              background-position: 0 -23px; }
        /* line 34 */
        #frame #content {
          padding-left: 120px;
          padding-right: 120px; }
      
      /* line 38 */
      pre {
        padding: 30px; }
    </style>
</head>
<body>
    <a href="http://github.com/secondstory/secondstoryjs-router"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
    <div id="frame">
      <h1><a href="http://secondstory.com">Second Story</a></h1>
      <div id="content">
        <h2>SecondStoryJS: Router</h2>
        
        <p>SecondStoryJS is our front-end development framework built as a collection of plugins for JavascriptMVC3. This plugin, the Router, addresses the issue of responding to URL changes which trigger actions and events, but do not reload the page. This interaction is widespread on AJAX and Flash websites to provide unique urls which can be copied and shared while retaining the "all in one page" features that allow modern webapps to be fast, responsive and more interactive than their static predecessors.</p>
        
        <h3>Features</h3>
        
        <ul>
<li><p>At the lowest level, the Router provides access to Sherpa, which is Joshua Hull's pure javascript router which can run either in-browser or on the NodeJS platform. Directly interacting and manipulating this library is known as "Basic Routing" and is documented below.</p></li>
        <li><p>The middle level of integration is a JavascriptMVC3 Controller instance that monitors URL changes and emits OpenAjax events which your code can respond to.</p></li>
        <li><p>The highest level of integration is a JavascriptMVC Controller "subscriber" which allows controllers to bind functions to URLs (and URL changes) much like Aaron Quint's popular <a href="http://github.com/quirkey/sammy">SammyJS</a> framework.</p></li>
        </ul>
<h4>Basic Routing</h4>
        
        <p>Because Basic Routing is simply a wrapper around Sherpa, all the functionality described in the <a href="http://github.com/joshbuddy/sherpa#readme">Sherpa Documentation</a> applies here.</p>
        
        <p>There are two actions which can be taken.</p>
        
        <p>First, you can create the possible routes which can be matched against. The syntax is as follows (and better documented on the Sherpa site):</p>
        
        <pre class="twilight">Router.<span class="SupportFunction">add</span>(<span class="String"><span class="String">'</span>/test/:variable<span class="String">'</span></span>).to(<span class="String"><span class="String">'</span>testing<span class="String">'</span></span>);
Router.recognize(<span class="String"><span class="String">'</span>/test/iloveyou<span class="String">'</span></span>) <span class="Keyword">-</span><span class="Keyword">&gt;</span>
  {
    <span class="String"><span class="String">"</span>destination<span class="String">"</span></span>: <span class="String"><span class="String">"</span>testing<span class="String">"</span></span>,
    <span class="String"><span class="String">"</span>params<span class="String">"</span></span>: {
      <span class="String"><span class="String">"</span>variable<span class="String">"</span></span>: <span class="String"><span class="String">"</span>iloveyou<span class="String">"</span></span>
    }
  }
</pre>
        
        <p>As you can see, the first command creates a route with a slot for a variable and sets a name for this particular route. The second command tries to match a route against the defined routes and returns the matching description.</p>
        
        <p>A full example of the code in-use in JavascriptMVC3 would look like:</p>
        
        <pre class="twilight">steal.plugin(<span class="String"><span class="String">"</span>ss/router/sherpa<span class="String">"</span></span>)
     .then(<span class="Storage">function</span>(<span class="Keyword">$</span>) {

  <span class="Storage">var</span> Router <span class="Keyword">=</span> <span class="Keyword">new</span> <span class="Entity">Sherpa.Router</span>();
  Router.<span class="SupportFunction">add</span>(<span class="String"><span class="String">"</span>/articles/:article_name<span class="String">"</span></span>).to(<span class="String"><span class="String">"</span>project_article<span class="String">"</span></span>);

  <span class="Storage">var</span> key        <span class="Keyword">=</span> <span class="Support">window</span>.<span class="SupportConstant">location</span>.<span class="SupportConstant">pathname</span>,
      foundRoute <span class="Keyword">=</span> Router.recognize(key);

  <span class="Keyword">if</span> (foundRoute <span class="Keyword">&amp;</span><span class="Keyword">&amp;</span> <span class="Keyword">$</span>(<span class="Support">document</span>)[foundRoute.destination]) {
    <span class="Keyword">$</span>(<span class="Support">document</span>)[foundRoute.destination](foundRoute.params);
  }
});
</pre>
        
        <p>The above code loads the JavascriptMVC3 plugin we provide, initalizes the router, adds a route and then matches the current URL against the route. If the route matches successfully, a jquery plugin is called on the document element with the parameters found in the match.</p>
        
        <h4>Route Change Events &amp; Router Controller</h4>
        
        <p>The Route Controller simplifies the interaction by using OpenAjax events to allow multiple subscribers to respond to a single URL change.</p>
        
        <pre class="twilight">steal.<span class="SupportConstant">plugins</span>(<span class="String"><span class="String">"</span>ss/router/controller<span class="String">"</span></span>)
     .then(<span class="Storage">function</span>(<span class="Keyword">$</span>) {

  Router.<span class="SupportFunction">add</span>(<span class="String"><span class="String">"</span>/articles/:article_name<span class="String">"</span></span>).to(<span class="String"><span class="String">"</span>project_article<span class="String">"</span></span>);
});
</pre>
        
        <p>When #/articles/my-first-article is accessed, OpenAjax will publish a project_article event with "my-first-article" as the "article_name" parameter.</p>
        
        <h4>Route Subscriptions</h4>
        
        <p>The final means of integration is to monitor URL changes in individual JavascriptMVC3 Controllers. This is very similar to the way SammyJS functions.</p>
        
        <pre class="twilight">steal.<span class="SupportConstant">plugins</span>(<span class="String"><span class="String">"</span>jquery/controller<span class="String">"</span></span>,
              <span class="String"><span class="String">"</span>ss/router/subscribe<span class="String">"</span></span>)
     .then(<span class="Storage">function</span>(<span class="Keyword">$</span>) {

  <span class="Keyword">$</span>.Controller.extend(<span class="String"><span class="String">"</span>MyController<span class="String">"</span></span>, {
  },
  {
    <span class="String"><span class="String">"</span><span class="Entity">/homepage route</span><span class="String">"</span></span>: <span class="Entity">function</span>() {
      <span class="Comment"><span class="Comment">//</span> Setup homepage javascript</span>
    },

    <span class="String"><span class="String">"</span><span class="Entity">/about/:user route</span><span class="String">"</span></span>: <span class="Entity">function</span>(<span class="Variable">params</span>) {
      <span class="Comment"><span class="Comment">//</span> Show information about a user</span>
      <span class="Comment"><span class="Comment">//</span> The URL "/about/bob" with call this function</span>
      <span class="Comment"><span class="Comment">//</span> params will contain { :user =&gt; "bob" }</span>
    }
  });

});
</pre>
        
        <h3>Installation</h3>
        
        <p>The source code is available on GitHub at <a href="http://github.com/secondstory/secondstoryjs-router">http://github.com/secondstory/secondstoryjs-router</a>. Please, fork the project, make your own changes and we'll happily pull bug fixes and new features into the official repository.</p>
        
        <p>However, JavascriptMVC3 provides an easier way to download plugins. From your project folder, simply run:</p>
        
        <pre class="twilight">./steal/js steal/getjs ss/router
</pre>
        
        <p>This will download the full plugin into your working directory.</p>
        
        <h3>License</h3>
        
        <p>This code is provided under the <a href="http://github.com/secondstory/secondstoryjs-router/blob/master/LICENSE">MIT License</a>.</p>
        
        <h3>Bugs</h3>
        
        <p>Please submit any bug reports to the project issue tracker on GitHub at: <a href="http://github.com/secondstory/secondstoryjs-router/issues">http://github.com/secondstory/secondstoryjs-router/issues</a>.</p>
      </div>
    </div>
    <script type="text/javascript">
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-16557054-5']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
</body>
</html>

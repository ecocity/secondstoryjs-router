<!DOCTYPE html>
<html>
  <head>
    <title>SecondStoryJS: Router</title>
    <link type="text/css" rel="stylesheet" href="stylesheets/site.css" />
    <link type="text/css" rel="stylesheet" href="stylesheets/twilight.css" />
  </head>
  <body>
    <a href="http://github.com/secondstory/secondstoryjs-router"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
      
    <div id="frame">
      <h1><a href="http://secondstory.com">Second Story</a></h1>
      
      <div id="content">
        <h2>SecondStoryJS: Router (v1.0.0)</h2>
<p>SecondStoryJS is our front-end development framework built as a collection of plugins for JavascriptMVC3. This plugin, the Router, addresses the issue of responding to URL changes which trigger actions and events, but do not reload the page. This interaction is widespread on AJAX and Flash websites to provide unique urls which can be copied and shared while retaining the "all in one page" features that allow modern webapps to be fast, responsive and more interactive than their static predecessors.</p>

<h3>Features</h3>
<ul>
  <li>At the lowest level, the Router provides access to Sherpa, which is Joshua Hull's pure javascript router which can run either in-browser or on the NodeJS platform. Directly interacting and manipulating this library is known as "Basic Routing" and is documented below.</li>
  <li>The middle level of integration is a JavascriptMVC3 Controller instance that monitors URL changes and emits OpenAjax events which your code can respond to.</li>
  <li>The highest level of integration is a JavascriptMVC Controller "subscriber" which allows controllers to bind functions to URLs (and URL changes) much like Aaron Quint's popular <a href="http://github.com/quirkey/sammy">SammyJS</a> framework.</li>
</ul>

<h4>Basic Routing</h4>
<p>Because Basic Routing is simply a wrapper around Sherpa, all the functionality described in the <a href="http://github.com/joshbuddy/sherpa#readme">Sherpa Documentation</a> applies here.</p>
<p>There are two actions which can be taken.</p>
<p>First, you can create the possible routes which can be matched against. The syntax is as follows (and better documented on the Sherpa site):</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">Router</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;/test/:variable&#39;</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="s1">&#39;testing&#39;</span><span class="p">);</span>
<span class="nx">Router</span><span class="p">.</span><span class="nx">recognize</span><span class="p">(</span><span class="s1">&#39;/test/iloveyou&#39;</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">{</span>
    <span class="s2">&quot;destination&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;iloveyou&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre>
</div>

<p>As you can see, the first command creates a route with a slot for a variable and sets a name for this particular route. The second command tries to match a route against the defined routes and returns the matching description.</p>

<p>A full example of the code in-use in JavascriptMVC3 would look like:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">steal</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s2">&quot;ss/router/sherpa&quot;</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">Router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sherpa</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
  <span class="nx">Router</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;/articles/:article_name&quot;</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="s2">&quot;project_article&quot;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">key</span>        <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span>
      <span class="nx">foundRoute</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">.</span><span class="nx">recognize</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">foundRoute</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)[</span><span class="nx">foundRoute</span><span class="p">.</span><span class="nx">destination</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)[</span><span class="nx">foundRoute</span><span class="p">.</span><span class="nx">destination</span><span class="p">](</span><span class="nx">foundRoute</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The above code loads the JavascriptMVC3 plugin we provide, initalizes the router, adds a route and then matches the current URL against the route. If the route matches successfully, a jquery plugin is called on the document element with the parameters found in the match.</p>

<h4>Route Change Events &amp; Router Controller</h4>
<p>The Route Controller simplifies the interaction by using OpenAjax events to allow multiple subscribers to respond to a single URL change.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">steal</span><span class="p">.</span><span class="nx">plugins</span><span class="p">(</span><span class="s2">&quot;ss/router/controller&quot;</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">Router</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;/articles/:article_name&quot;</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="s2">&quot;project_article&quot;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>When #/articles/my-first-article is accessed, OpenAjax will publish a project_article event with "my-first-article" as the "article_name" parameter.</p>

<h4>Route Subscriptions</h4>
<p>The final means of integration is to monitor URL changes in individual JavascriptMVC3 Controllers. This is very similar to the way SammyJS functions.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">steal</span><span class="p">.</span><span class="nx">plugins</span><span class="p">(</span><span class="s2">&quot;jquery/controller&quot;</span><span class="p">,</span>
              <span class="s2">&quot;ss/router/subscribe&quot;</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
     
  <span class="nx">$</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;MyController&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;/homepage route&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Setup homepage javascript</span>
    <span class="p">},</span>
    
    <span class="s2">&quot;/about/:user route&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Show information about a user</span>
      <span class="c1">// The URL &quot;/about/bob&quot; with call this function</span>
      <span class="c1">// params will contain { :user =&gt; &quot;bob&quot; }</span>
    <span class="p">}</span>
  <span class="p">});</span>
  
<span class="p">});</span>
</code></pre>
</div>

<h3>Installation</h3>
<p>The source code is available on GitHub at <a href="http://github.com/secondstory/secondstoryjs-router">http://github.com/secondstory/secondstoryjs-router</a>. Please, fork the project, make your own changes and we'll happily pull bug fixes and new features into the official repository.</p>
<p>However, JavascriptMVC3 provides an easier way to download plugins. From your project folder, simply run:</p>
<pre>./steal/js steal/getjs ss/router</pre>
<p>This will download the full plugin into your working directory.</p>

<h3>License</h3>
<p>This code is provided under the <a href="http://github.com/secondstory/secondstoryjs-router/blob/master/LICENSE">MIT License</a>.</p>

<h3>Bugs</h3>
<p>Please submit any bug reports to the project issue tracker on GitHub at: <a href="http://github.com/secondstory/secondstoryjs-router/issues">http://github.com/secondstory/secondstoryjs-router/issues</a>.</p>

      </div>
    </div>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16557054-5']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
